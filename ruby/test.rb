# coding: utf-8
require "pp"

if (RUBY_PLATFORM.downcase=~/mswin(?!ce)|mingw|cygwin|bccwin/)
  #Windows
  require "./\windowscomport.rb"
else
  #Linux
  require "./linuxcomport.rb"
end

#sendData=[
#0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,0x0000,
#0x0020,0x607e,0x3184,0x1648,0x0130,0x00c0,0x0700,0xf1fc, 0x1320,0x1020,0x17ff,0x1020,0x1222,0x33fe,0x6800,0xc7ff,
#0x0000,0x00f8,0x0020,0x0020,0x0020,0x0020,0x0020,0x0020, 0x0020,0x0020,0x0020,0x1020,0x1840,0x0f80,0x0000,0x0000 ,
#0x0020,0x607e,0x3184,0x1648,0x0130,0x00c0,0x0700,0xf1fc, 0x1320,0x1020,0x17ff,0x1020,0x1222,0x33fe,0x6800,0xc7ff,
#0x0000,0x00f8,0x0020,0x0020,0x0020,0x0020,0x0020,0x0020, 0x0020,0x0020,0x0020,0x1020,0x1840,0x0f80,0x0000,0x0000 ,
#0x0000,0x00f8,0x0020,0x0020,0x0020,0x0020,0x0020,0x0020, 0x0020,0x0020,0x0020,0x1020,0x1840,0x0f80,0x0000,0x0000 ,
#0x0000,0x0020,0x0020,0x0020,0x1ffe,0x0020,0x0060,0x00a0,0x00a0,0x0120,0x0220,0x0420,0x1820,0x0020,0x00e0,0x0000
#]
#構造体定義
FontData=Struct.new("FontData",:char,:dot_data)
fontdatas = Array.new
mode = nil
bitmap=[]
char=nil
File.foreach("./font/kanjic/font_src.bit", :encoding => Encoding::EUC_JP){ |f|
  if /BITMAP/ =~f
    bitmap=[]
    char=nil
    mode="BMP"
  elsif mode=="BMP" && /ENDCHAR/ =~f
    mode="START"
    char= f.delete("ENDCHAR #").encode("UTF-8","EUC-JP").chop
    fontdatas << FontData.new(char,bitmap)
  elsif mode=="BMP"
    bitmap.push f.chop.gsub(".","0").gsub("@","1").to_i(2)
    
  end
}
sendData=[]
string="∥"
string.split(//).each{|c|
  fontdatas.each{|d|
    if(d.char==c)
  puts c
     sendData.push d.dot_data
    end
  }
}
sendData.flatten!
#pp sendData

com = Com.new
com.open
12.times do
    com.put_bin(sendData)
   sleep(0.5)
  end
com.close



puts "Start"
